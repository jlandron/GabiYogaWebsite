#!/usr/bin/env node
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = __importStar(require("aws-cdk-lib"));
const lambda_db_stack_1 = require("../lib/lambda-db-stack");
const lambda_api_stack_1 = require("../lib/lambda-api-stack");
const lambda_auth_stack_1 = require("../lib/lambda-auth-stack");
const lambda_monitoring_stack_1 = require("../lib/lambda-monitoring-stack");
const lambda_ses_stack_1 = require("../lib/lambda-ses-stack");
const lambda_route53_stack_1 = require("../lib/lambda-route53-stack");
const app = new cdk.App();
// Get stage from context (dev/prod)
const stage = app.node.tryGetContext('stage') || 'dev';
const region = 'us-east-1';
const account = '891709159344';
// Environment configuration
const env = {
    account,
    region,
};
// Stack name prefix
const stackPrefix = `GabiYogaLambda-${stage}`;
// Tags for all stacks
const commonTags = {
    Project: 'GabiYoga',
    Environment: stage,
    Service: 'Lambda',
    ManagedBy: 'CDK',
};
// Database Stack - DynamoDB tables and related resources
const dbStack = new lambda_db_stack_1.LambdaDbStack(app, `${stackPrefix}-Database`, {
    env,
    stage,
    tags: commonTags,
    description: `Gabi Yoga Lambda Database Stack (${stage})`,
});
// Authentication Stack - JWT secrets, user authentication resources
const authStack = new lambda_auth_stack_1.LambdaAuthStack(app, `${stackPrefix}-Auth`, {
    env,
    stage,
    tags: commonTags,
    description: `Gabi Yoga Lambda Authentication Stack (${stage})`,
    // Pass database references
    usersTable: dbStack.usersTable,
    jwtBlacklistTable: dbStack.jwtBlacklistTable,
});
// API Stack - Lambda functions and API Gateway
const apiStack = new lambda_api_stack_1.LambdaApiStack(app, `${stackPrefix}-Api`, {
    env,
    stage,
    tags: commonTags,
    description: `Gabi Yoga Lambda API Stack (${stage})`,
    // Pass database table references
    usersTable: dbStack.usersTable,
    blogPostsTable: dbStack.blogPostsTable,
    classesTable: dbStack.classesTable,
    bookingsTable: dbStack.bookingsTable,
    retreatsTable: dbStack.retreatsTable,
    workshopsTable: dbStack.workshopsTable,
    galleryTable: dbStack.galleryTable,
    settingsTable: dbStack.settingsTable,
    communicationsTable: dbStack.communicationsTable,
    jwtBlacklistTable: dbStack.jwtBlacklistTable,
    // Pass auth resources
    jwtSecret: authStack.jwtSecret,
    stripeSecret: authStack.stripeSecret,
});
// Monitoring Stack - CloudWatch dashboards, alarms, and logs
const monitoringStack = new lambda_monitoring_stack_1.LambdaMonitoringStack(app, `${stackPrefix}-Monitoring`, {
    env,
    stage,
    tags: commonTags,
    description: `Gabi Yoga Lambda Monitoring Stack (${stage})`,
    // Pass API Gateway and Lambda references for monitoring
    apiGateway: apiStack.apiGateway,
    lambdaFunctions: apiStack.lambdaFunctions,
    dynamodbTables: dbStack.dynamodbTables,
});
// SES Stack - Email sending infrastructure
const sesStack = new lambda_ses_stack_1.LambdaSesStack(app, `${stackPrefix}-SES`, {
    env,
    stage,
    tags: commonTags,
    description: `Gabi Yoga Lambda SES Email Stack (${stage})`,
    domainName: 'gabi.yoga',
    // If we have the hosted zone ID, we'd include it here
    // hostedZoneId: 'Z1234567890ABC',
});
// Route53 Stack - Custom domain for API Gateway
const route53Stack = new lambda_route53_stack_1.LambdaRoute53Stack(app, `${stackPrefix}-Route53`, {
    env,
    stage,
    tags: commonTags,
    description: `Gabi Yoga Lambda Route53 Stack (${stage})`,
    apiGateway: apiStack.apiGateway,
    domainName: 'gabi.yoga',
});
// Stack dependencies
apiStack.addDependency(dbStack);
apiStack.addDependency(authStack);
apiStack.addDependency(sesStack);
monitoringStack.addDependency(apiStack);
route53Stack.addDependency(apiStack);
// Output key information
new cdk.CfnOutput(apiStack, 'ApiGatewayUrl', {
    value: apiStack.apiGateway.url,
    description: 'API Gateway URL',
    exportName: `${stackPrefix}-ApiGatewayUrl`,
});
new cdk.CfnOutput(apiStack, 'ApiGatewayId', {
    value: apiStack.apiGateway.restApiId,
    description: 'API Gateway ID',
    exportName: `${stackPrefix}-ApiGatewayId`,
});
// Custom domain output for production
if (stage === 'prod') {
    new cdk.CfnOutput(apiStack, 'CustomDomainName', {
        value: 'api.gabi.yoga',
        description: 'Custom domain name for API',
        exportName: `${stackPrefix}-CustomDomainName`,
    });
}
// Environment-specific outputs
new cdk.CfnOutput(dbStack, 'DatabaseStackName', {
    value: dbStack.stackName,
    description: 'Database stack name',
    exportName: `${stackPrefix}-DatabaseStackName`,
});
new cdk.CfnOutput(authStack, 'AuthStackName', {
    value: authStack.stackName,
    description: 'Authentication stack name',
    exportName: `${stackPrefix}-AuthStackName`,
});
new cdk.CfnOutput(monitoringStack, 'MonitoringDashboardUrl', {
    value: monitoringStack.dashboardUrl,
    description: 'CloudWatch Dashboard URL',
    exportName: `${stackPrefix}-MonitoringDashboardUrl`,
});
new cdk.CfnOutput(sesStack, 'EmailDomain', {
    value: 'gabi.yoga',
    description: 'Email domain for sending emails',
    exportName: `${stackPrefix}-EmailDomain`,
});
new cdk.CfnOutput(sesStack, 'DefaultSenderEmail', {
    value: 'noreply@gabi.yoga',
    description: 'Default sender email address',
    exportName: `${stackPrefix}-DefaultSenderEmail`,
});
// Route53 outputs are already defined in the stack
new cdk.CfnOutput(route53Stack, 'ApiCustomDomain', {
    value: route53Stack.customDomainName,
    description: 'Custom domain for API',
    exportName: `${stackPrefix}-ApiCustomDomain`,
});
// Add stack information for debugging
console.log(`Deploying Gabi Yoga Lambda stacks for ${stage} environment:`);
console.log(`- Database Stack: ${dbStack.stackName}`);
console.log(`- Auth Stack: ${authStack.stackName}`);
console.log(`- API Stack: ${apiStack.stackName}`);
console.log(`- Monitoring Stack: ${monitoringStack.stackName}`);
console.log(`- SES Stack: ${sesStack.stackName}`);
console.log(`- Route53 Stack: ${route53Stack.stackName}`);
console.log(`- Region: ${region}`);
console.log(`- Account: ${account}`);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFtYmRhLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGFtYmRhLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsdUNBQXFDO0FBQ3JDLGlEQUFtQztBQUNuQyw0REFBdUQ7QUFDdkQsOERBQXlEO0FBQ3pELGdFQUEyRDtBQUMzRCw0RUFBdUU7QUFDdkUsOERBQXlEO0FBQ3pELHNFQUFpRTtBQUVqRSxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUUxQixvQ0FBb0M7QUFDcEMsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDO0FBQ3ZELE1BQU0sTUFBTSxHQUFHLFdBQVcsQ0FBQztBQUMzQixNQUFNLE9BQU8sR0FBRyxjQUFjLENBQUM7QUFFL0IsNEJBQTRCO0FBQzVCLE1BQU0sR0FBRyxHQUFHO0lBQ1YsT0FBTztJQUNQLE1BQU07Q0FDUCxDQUFDO0FBRUYsb0JBQW9CO0FBQ3BCLE1BQU0sV0FBVyxHQUFHLGtCQUFrQixLQUFLLEVBQUUsQ0FBQztBQUU5QyxzQkFBc0I7QUFDdEIsTUFBTSxVQUFVLEdBQUc7SUFDakIsT0FBTyxFQUFFLFVBQVU7SUFDbkIsV0FBVyxFQUFFLEtBQUs7SUFDbEIsT0FBTyxFQUFFLFFBQVE7SUFDakIsU0FBUyxFQUFFLEtBQUs7Q0FDakIsQ0FBQztBQUVGLHlEQUF5RDtBQUN6RCxNQUFNLE9BQU8sR0FBRyxJQUFJLCtCQUFhLENBQUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxXQUFXLEVBQUU7SUFDaEUsR0FBRztJQUNILEtBQUs7SUFDTCxJQUFJLEVBQUUsVUFBVTtJQUNoQixXQUFXLEVBQUUsb0NBQW9DLEtBQUssR0FBRztDQUMxRCxDQUFDLENBQUM7QUFFSCxvRUFBb0U7QUFDcEUsTUFBTSxTQUFTLEdBQUcsSUFBSSxtQ0FBZSxD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QVMsRUFBRSxDQUFDLENBQUM7QUFDMUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDbkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLE9BQU8sRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIjIS91c3IvYmluL2VudiBub2RlXG5pbXBvcnQgJ3NvdXJjZS1tYXAtc3VwcG9ydC9yZWdpc3Rlcic7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHsgTGFtYmRhRGJTdGFjayB9IGZyb20gJy4uL2xpYi9sYW1iZGEtZGItc3RhY2snO1xuaW1wb3J0IHsgTGFtYmRhQXBpU3RhY2sgfSBmcm9tICcuLi9saWIvbGFtYmRhLWFwaS1zdGFjayc7XG5pbXBvcnQgeyBMYW1iZGFBdXRoU3RhY2sgfSBmcm9tICcuLi9saWIvbGFtYmRhLWF1dGgtc3RhY2snO1xuaW1wb3J0IHsgTGFtYmRhTW9uaXRvcmluZ1N0YWNrIH0gZnJvbSAnLi4vbGliL2xhbWJkYS1tb25pdG9yaW5nLXN0YWNrJztcbmltcG9ydCB7IExhbWJkYVNlc1N0YWNrIH0gZnJvbSAnLi4vbGliL2xhbWJkYS1zZXMtc3RhY2snO1xuaW1wb3J0IHsgTGFtYmRhUm91dGU1M1N0YWNrIH0gZnJvbSAnLi4vbGliL2xhbWJkYS1yb3V0ZTUzLXN0YWNrJztcblxuY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcblxuLy8gR2V0IHN0YWdlIGZyb20gY29udGV4dCAoZGV2L3Byb2QpXG5jb25zdCBzdGFnZSA9IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ3N0YWdlJykgfHwgJ2Rldic7XG5jb25zdCByZWdpb24gPSAndXMtZWFzdC0xJztcbmNvbnN0IGFjY291bnQgPSAnODkxNzA5MTU5MzQ0JztcblxuLy8gRW52aXJvbm1lbnQgY29uZmlndXJhdGlvblxuY29uc3QgZW52ID0ge1xuICBhY2NvdW50LFxuICByZWdpb24sXG59O1xuXG4vLyBTdGFjayBuYW1lIHByZWZpeFxuY29uc3Qgc3RhY2tQcmVmaXggPSBgR2FiaVlvZ2FMYW1iZGEtJHtzdGFnZX1gO1xuXG4vLyBUYWdzIGZvciBhbGwgc3RhY2tzXG5jb25zdCBjb21tb25UYWdzID0ge1xuICBQcm9qZWN0OiAnR2FiaVlvZ2EnLFxuICBFbnZpcm9ubWVudDogc3RhZ2UsXG4gIFNlcnZpY2U6ICdMYW1iZGEnLFxuICBNYW5hZ2VkQnk6ICdDREsnLFxufTtcblxuLy8gRGF0YWJhc2UgU3RhY2sgLSBEeW5hbW9EQiB0YWJsZXMgYW5kIHJlbGF0ZWQgcmVzb3VyY2VzXG5jb25zdCBkYlN0YWNrID0gbmV3IExhbWJkYURiU3RhY2soYXBwLCBgJHtzdGFja1ByZWZpeH0tRGF0YWJhc2VgLCB7XG4gIGVudixcbiAgc3RhZ2UsXG4gIHRhZ3M6IGNvbW1vblRhZ3MsXG4gIGRlc2NyaXB0aW9uOiBgR2FiaSBZb2dhIExhbWJkYSBEYXRhYmFzZSBTdGFjayAoJHtzdGFnZX0pYCxcbn0pO1xuXG4vLyBBdXRoZW50aWNhdGlvbiBTdGFjayAtIEpXVCBzZWNyZXRzLCB1c2VyIGF1dGhlbnRpY2F0aW9uIHJlc291cmNlc1xuY29uc3QgYXV0aFN0YWNrID0gbmV3IExhbWJkYUF1dGhTdGFjayhhcHAsIGAke3N0YWNrUHJlZml4fS1BdXRoYCwge1xuICBlbnYsXG4gIHN0YWdlLFxuICB0YWdzOiBjb21tb25UYWdzLFxuICBkZXNjcmlwdGlvbjogYEdhYmkgWW9nYSBMYW1iZGEgQXV0aGVudGljYXRpb24gU3RhY2sgKCR7c3RhZ2V9KWAsXG4gIC8vIFBhc3MgZGF0YWJhc2UgcmVmZXJlbmNlc1xuICB1c2Vyc1RhYmxlOiBkYlN0YWNrLnVzZXJzVGFibGUsXG4gIGp3dEJsYWNrbGlzdFRhYmxlOiBkYlN0YWNrLmp3dEJsYWNrbGlzdFRhYmxlLFxufSk7XG5cbi8vIEFQSSBTdGFjayAtIExhbWJkYSBmdW5jdGlvbnMgYW5kIEFQSSBHYXRld2F5XG5jb25zdCBhcGlTdGFjayA9IG5ldyBMYW1iZGFBcGlTdGFjayhhcHAsIGAke3N0YWNrUHJlZml4fS1BcGlgLCB7XG4gIGVudixcbiAgc3RhZ2UsXG4gIHRhZ3M6IGNvbW1vblRhZ3MsXG4gIGRlc2NyaXB0aW9uOiBgR2FiaSBZb2dhIExhbWJkYSBBUEkgU3RhY2sgKCR7c3RhZ2V9KWAsXG4gIC8vIFBhc3MgZGF0YWJhc2UgdGFibGUgcmVmZXJlbmNlc1xuICB1c2Vyc1RhYmxlOiBkYlN0YWNrLnVzZXJzVGFibGUsXG4gIGJsb2dQb3N0c1RhYmxlOiBkYlN0YWNrLmJsb2dQb3N0c1RhYmxlLFxuICBjbGFzc2VzVGFibGU6IGRiU3RhY2suY2xhc3Nlc1RhYmxlLFxuICBib29raW5nc1RhYmxlOiBkYlN0YWNrLmJvb2tpbmdzVGFibGUsXG4gIHJldHJlYXRzVGFibGU6IGRiU3RhY2sucmV0cmVhdHNUYWJsZSxcbiAgd29ya3Nob3BzVGFibGU6IGRiU3RhY2sud29ya3Nob3BzVGFibGUsXG4gIGdhbGxlcnlUYWJsZTogZGJTdGFjay5nYWxsZXJ5VGFibGUsXG4gIHNldHRpbmdzVGFibGU6IGRiU3RhY2suc2V0dGluZ3NUYWJsZSxcbiAgY29tbXVuaWNhdGlvbnNUYWJsZTogZGJTdGFjay5jb21tdW5pY2F0aW9uc1RhYmxlLFxuICBqd3RCbGFja2xpc3RUYWJsZTogZGJTdGFjay5qd3RCbGFja2xpc3RUYWJsZSxcbiAgLy8gUGFzcyBhdXRoIHJlc291cmNlc1xuICBqd3RTZWNyZXQ6IGF1dGhTdGFjay5qd3RTZWNyZXQsXG4gIHN0cmlwZVNlY3JldDogYXV0aFN0YWNrLnN0cmlwZVNlY3JldCxcbn0pO1xuXG4vLyBNb25pdG9yaW5nIFN0YWNrIC0gQ2xvdWRXYXRjaCBkYXNoYm9hcmRzLCBhbGFybXMsIGFuZCBsb2dzXG5jb25zdCBtb25pdG9yaW5nU3RhY2sgPSBuZXcgTGFtYmRhTW9uaXRvcmluZ1N0YWNrKGFwcCwgYCR7c3RhY2tQcmVmaXh9LU1vbml0b3JpbmdgLCB7XG4gIGVudixcbiAgc3RhZ2UsXG4gIHRhZ3M6IGNvbW1vblRhZ3MsXG4gIGRlc2NyaXB0aW9uOiBgR2FiaSBZb2dhIExhbWJkYSBNb25pdG9yaW5nIFN0YWNrICgke3N0YWdlfSlgLFxuICAvLyBQYXNzIEFQSSBHYXRld2F5IGFuZCBMYW1iZGEgcmVmZXJlbmNlcyBmb3IgbW9uaXRvcmluZ1xuICBhcGlHYXRld2F5OiBhcGlTdGFjay5hcGlHYXRld2F5LFxuICBsYW1iZGFGdW5jdGlvbnM6IGFwaVN0YWNrLmxhbWJkYUZ1bmN0aW9ucyxcbiAgZHluYW1vZGJUYWJsZXM6IGRiU3RhY2suZHluYW1vZGJUYWJsZXMsXG59KTtcblxuLy8gU0VTIFN0YWNrIC0gRW1haWwgc2VuZGluZyBpbmZyYXN0cnVjdHVyZVxuY29uc3Qgc2VzU3RhY2sgPSBuZXcgTGFtYmRhU2VzU3RhY2soYXBwLCBgJHtzdGFja1ByZWZpeH0tU0VTYCwge1xuICBlbnYsXG4gIHN0YWdlLFxuICB0YWdzOiBjb21tb25UYWdzLFxuICBkZXNjcmlwdGlvbjogYEdhYmkgWW9nYSBMYW1iZGEgU0VTIEVtYWlsIFN0YWNrICgke3N0YWdlfSlgLFxuICBkb21haW5OYW1lOiAnZ2FiaS55b2dhJyxcbiAgLy8gSWYgd2UgaGF2ZSB0aGUgaG9zdGVkIHpvbmUgSUQsIHdlJ2QgaW5jbHVkZSBpdCBoZXJlXG4gIC8vIGhvc3RlZFpvbmVJZDogJ1oxMjM0NTY3ODkwQUJDJyxcbn0pO1xuXG4vLyBSb3V0ZTUzIFN0YWNrIC0gQ3VzdG9tIGRvbWFpbiBmb3IgQVBJIEdhdGV3YXlcbmNvbnN0IHJvdXRlNTNTdGFjayA9IG5ldyBMYW1iZGFSb3V0ZTUzU3RhY2soYXBwLCBgJHtzdGFja1ByZWZpeH0tUm91dGU1M2AsIHtcbiAgZW52LFxuICBzdGFnZSxcbiAgdGFnczogY29tbW9uVGFncyxcbiAgZGVzY3JpcHRpb246IGBHYWJpIFlvZ2EgTGFtYmRhIFJvdXRlNTMgU3RhY2sgKCR7c3RhZ2V9KWAsXG4gIGFwaUdhdGV3YXk6IGFwaVN0YWNrLmFwaUdhdGV3YXksXG4gIGRvbWFpbk5hbWU6ICdnYWJpLnlvZ2EnLFxufSk7XG5cbi8vIFN0YWNrIGRlcGVuZGVuY2llc1xuYXBpU3RhY2suYWRkRGVwZW5kZW5jeShkYlN0YWNrKTtcbmFwaVN0YWNrLmFkZERlcGVuZGVuY3koYXV0aFN0YWNrKTtcbmFwaVN0YWNrLmFkZERlcGVuZGVuY3koc2VzU3RhY2spO1xubW9uaXRvcmluZ1N0YWNrLmFkZERlcGVuZGVuY3koYXBpU3RhY2spO1xucm91dGU1M1N0YWNrLmFkZERlcGVuZGVuY3koYXBpU3RhY2spO1xuXG4vLyBPdXRwdXQga2V5IGluZm9ybWF0aW9uXG5uZXcgY2RrLkNmbk91dHB1dChhcGlTdGFjaywgJ0FwaUdhdGV3YXlVcmwnLCB7XG4gIHZhbHVlOiBhcGlTdGFjay5hcGlHYXRld2F5LnVybCxcbiAgZGVzY3JpcHRpb246ICdBUEkgR2F0ZXdheSBVUkwnLFxuICBleHBvcnROYW1lOiBgJHtzdGFja1ByZWZpeH0tQXBpR2F0ZXdheVVybGAsXG59KTtcblxubmV3IGNkay5DZm5PdXRwdXQoYXBpU3RhY2ssICdBcGlHYXRld2F5SWQnLCB7XG4gIHZhbHVlOiBhcGlTdGFjay5hcGlHYXRld2F5LnJlc3RBcGlJZCxcbiAgZGVzY3JpcHRpb246ICdBUEkgR2F0ZXdheSBJRCcsXG4gIGV4cG9ydE5hbWU6IGAke3N0YWNrUHJlZml4fS1BcGlHYXRld2F5SWRgLFxufSk7XG5cbi8vIEN1c3RvbSBkb21haW4gb3V0cHV0IGZvciBwcm9kdWN0aW9uXG5pZiAoc3RhZ2UgPT09ICdwcm9kJykge1xuICBuZXcgY2RrLkNmbk91dHB1dChhcGlTdGFjaywgJ0N1c3RvbURvbWFpbk5hbWUnLCB7XG4gICAgdmFsdWU6ICdhcGkuZ2FiaS55b2dhJyxcbiAgICBkZXNjcmlwdGlvbjogJ0N1c3RvbSBkb21haW4gbmFtZSBmb3IgQVBJJyxcbiAgICBleHBvcnROYW1lOiBgJHtzdGFja1ByZWZpeH0tQ3VzdG9tRG9tYWluTmFtZWAsXG4gIH0pO1xufVxuXG4vLyBFbnZpcm9ubWVudC1zcGVjaWZpYyBvdXRwdXRzXG5uZXcgY2RrLkNmbk91dHB1dChkYlN0YWNrLCAnRGF0YWJhc2VTdGFja05hbWUnLCB7XG4gIHZhbHVlOiBkYlN0YWNrLnN0YWNrTmFtZSxcbiAgZGVzY3JpcHRpb246ICdEYXRhYmFzZSBzdGFjayBuYW1lJyxcbiAgZXhwb3J0TmFtZTogYCR7c3RhY2tQcmVmaXh9LURhdGFiYXNlU3RhY2tOYW1lYCxcbn0pO1xuXG5uZXcgY2RrLkNmbk91dHB1dChhdXRoU3RhY2ssICdBdXRoU3RhY2tOYW1lJywge1xuICB2YWx1ZTogYXV0aFN0YWNrLnN0YWNrTmFtZSxcbiAgZGVzY3JpcHRpb246ICdBdXRoZW50aWNhdGlvbiBzdGFjayBuYW1lJyxcbiAgZXhwb3J0TmFtZTogYCR7c3RhY2tQcmVmaXh9LUF1dGhTdGFja05hbWVgLFxufSk7XG5cbm5ldyBjZGsuQ2ZuT3V0cHV0KG1vbml0b3JpbmdTdGFjaywgJ01vbml0b3JpbmdEYXNoYm9hcmRVcmwnLCB7XG4gIHZhbHVlOiBtb25pdG9yaW5nU3RhY2suZGFzaGJvYXJkVXJsLFxuICBkZXNjcmlwdGlvbjogJ0Nsb3VkV2F0Y2ggRGFzaGJvYXJkIFVSTCcsXG4gIGV4cG9ydE5hbWU6IGAke3N0YWNrUHJlZml4fS1Nb25pdG9yaW5nRGFzaGJvYXJkVXJsYCxcbn0pO1xuXG5uZXcgY2RrLkNmbk91dHB1dChzZXNTdGFjaywgJ0VtYWlsRG9tYWluJywge1xuICB2YWx1ZTogJ2dhYmkueW9nYScsXG4gIGRlc2NyaXB0aW9uOiAnRW1haWwgZG9tYWluIGZvciBzZW5kaW5nIGVtYWlscycsXG4gIGV4cG9ydE5hbWU6IGAke3N0YWNrUHJlZml4fS1FbWFpbERvbWFpbmAsXG59KTtcblxubmV3IGNkay5DZm5PdXRwdXQoc2VzU3RhY2ssICdEZWZhdWx0U2VuZGVyRW1haWwnLCB7XG4gIHZhbHVlOiAnbm9yZXBseUBnYWJpLnlvZ2EnLFxuICBkZXNjcmlwdGlvbjogJ0RlZmF1bHQgc2VuZGVyIGVtYWlsIGFkZHJlc3MnLFxuICBleHBvcnROYW1lOiBgJHtzdGFja1ByZWZpeH0tRGVmYXVsdFNlbmRlckVtYWlsYCxcbn0pO1xuXG4vLyBSb3V0ZTUzIG91dHB1dHMgYXJlIGFscmVhZHkgZGVmaW5lZCBpbiB0aGUgc3RhY2tcblxubmV3IGNkay5DZm5PdXRwdXQocm91dGU1M1N0YWNrLCAnQXBpQ3VzdG9tRG9tYWluJywge1xuICB2YWx1ZTogcm91dGU1M1N0YWNrLmN1c3RvbURvbWFpbk5hbWUsXG4gIGRlc2NyaXB0aW9uOiAnQ3VzdG9tIGRvbWFpbiBmb3IgQVBJJyxcbiAgZXhwb3J0TmFtZTogYCR7c3RhY2tQcmVmaXh9LUFwaUN1c3RvbURvbWFpbmAsXG59KTtcblxuLy8gQWRkIHN0YWNrIGluZm9ybWF0aW9uIGZvciBkZWJ1Z2dpbmdcbmNvbnNvbGUubG9nKGBEZXBsb3lpbmcgR2FiaSBZb2dhIExhbWJkYSBzdGFja3MgZm9yICR7c3RhZ2V9IGVudmlyb25tZW50OmApO1xuY29uc29sZS5sb2coYC0gRGF0YWJhc2UgU3RhY2s6ICR7ZGJTdGFjay5zdGFja05hbWV9YCk7XG5jb25zb2xlLmxvZyhgLSBBdXRoIFN0YWNrOiAke2F1dGhTdGFjay5zdGFja05hbWV9YCk7XG5jb25zb2xlLmxvZyhgLSBBUEkgU3RhY2s6ICR7YXBpU3RhY2suc3RhY2tOYW1lfWApO1xuY29uc29sZS5sb2coYC0gTW9uaXRvcmluZyBTdGFjazogJHttb25pdG9yaW5nU3RhY2suc3RhY2tOYW1lfWApO1xuY29uc29sZS5sb2coYC0gU0VTIFN0YWNrOiAke3Nlc1N0YWNrLnN0YWNrTmFtZX1gKTtcbmNvbnNvbGUubG9nKGAtIFJvdXRlNTMgU3RhY2s6ICR7cm91dGU1M1N0YWNrLnN0YWNrTmFtZX1gKTtcbmNvbnNvbGUubG9nKGAtIFJlZ2lvbjogJHtyZWdpb259YCk7XG5jb25zb2xlLmxvZyhgLSBBY2NvdW50OiAke2FjY291bnR9YCk7XG4iXX0=